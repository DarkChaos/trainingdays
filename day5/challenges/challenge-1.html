<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Receive an ID Token in a Fragment URL | Azure Developer College</title>
    <meta name="generator" content="VuePress 1.6.0">
    
    <meta name="description" content="">
    <link rel="preload" href="/trainingdays/assets/css/0.styles.daa3f08c.css" as="style"><link rel="preload" href="/trainingdays/assets/js/app.b6fa1fb8.js" as="script"><link rel="preload" href="/trainingdays/assets/js/2.2f5bd62b.js" as="script"><link rel="preload" href="/trainingdays/assets/js/66.ecd2c22b.js" as="script"><link rel="prefetch" href="/trainingdays/assets/js/10.e95111fa.js"><link rel="prefetch" href="/trainingdays/assets/js/11.a421d3d1.js"><link rel="prefetch" href="/trainingdays/assets/js/12.6209790c.js"><link rel="prefetch" href="/trainingdays/assets/js/13.e534cef7.js"><link rel="prefetch" href="/trainingdays/assets/js/14.f4dffc2a.js"><link rel="prefetch" href="/trainingdays/assets/js/15.4e44c94a.js"><link rel="prefetch" href="/trainingdays/assets/js/16.a5cbb141.js"><link rel="prefetch" href="/trainingdays/assets/js/17.4e688daa.js"><link rel="prefetch" href="/trainingdays/assets/js/18.e696ad89.js"><link rel="prefetch" href="/trainingdays/assets/js/19.6b5a5300.js"><link rel="prefetch" href="/trainingdays/assets/js/20.e398d76d.js"><link rel="prefetch" href="/trainingdays/assets/js/21.6dccb1a9.js"><link rel="prefetch" href="/trainingdays/assets/js/22.6d2c78c9.js"><link rel="prefetch" href="/trainingdays/assets/js/23.cec9aba7.js"><link rel="prefetch" href="/trainingdays/assets/js/24.bced42e7.js"><link rel="prefetch" href="/trainingdays/assets/js/25.2c5dac2a.js"><link rel="prefetch" href="/trainingdays/assets/js/26.85dbec00.js"><link rel="prefetch" href="/trainingdays/assets/js/27.6ee0c889.js"><link rel="prefetch" href="/trainingdays/assets/js/28.3a1d2471.js"><link rel="prefetch" href="/trainingdays/assets/js/29.ad1ed90e.js"><link rel="prefetch" href="/trainingdays/assets/js/3.0b97a706.js"><link rel="prefetch" href="/trainingdays/assets/js/30.d8cfc5d9.js"><link rel="prefetch" href="/trainingdays/assets/js/31.21a8d652.js"><link rel="prefetch" href="/trainingdays/assets/js/32.1a717540.js"><link rel="prefetch" href="/trainingdays/assets/js/33.07047ecd.js"><link rel="prefetch" href="/trainingdays/assets/js/34.0aa0f483.js"><link rel="prefetch" href="/trainingdays/assets/js/35.a2f61a8c.js"><link rel="prefetch" href="/trainingdays/assets/js/36.38019c5d.js"><link rel="prefetch" href="/trainingdays/assets/js/37.198ddbd7.js"><link rel="prefetch" href="/trainingdays/assets/js/38.5e6cc1d0.js"><link rel="prefetch" href="/trainingdays/assets/js/39.6aaaeb6a.js"><link rel="prefetch" href="/trainingdays/assets/js/4.a85c8e91.js"><link rel="prefetch" href="/trainingdays/assets/js/40.c43b09f1.js"><link rel="prefetch" href="/trainingdays/assets/js/41.7941ef54.js"><link rel="prefetch" href="/trainingdays/assets/js/42.f4122eb3.js"><link rel="prefetch" href="/trainingdays/assets/js/43.05abe06d.js"><link rel="prefetch" href="/trainingdays/assets/js/44.6e3674c7.js"><link rel="prefetch" href="/trainingdays/assets/js/45.ccc038ae.js"><link rel="prefetch" href="/trainingdays/assets/js/46.71984eb3.js"><link rel="prefetch" href="/trainingdays/assets/js/47.2449eee8.js"><link rel="prefetch" href="/trainingdays/assets/js/48.57929ee6.js"><link rel="prefetch" href="/trainingdays/assets/js/49.5496b008.js"><link rel="prefetch" href="/trainingdays/assets/js/5.da18f642.js"><link rel="prefetch" href="/trainingdays/assets/js/50.59b33bd7.js"><link rel="prefetch" href="/trainingdays/assets/js/51.1fe59b53.js"><link rel="prefetch" href="/trainingdays/assets/js/52.235daa30.js"><link rel="prefetch" href="/trainingdays/assets/js/53.b2b4b02e.js"><link rel="prefetch" href="/trainingdays/assets/js/54.e1ed02fe.js"><link rel="prefetch" href="/trainingdays/assets/js/55.8ce8dce1.js"><link rel="prefetch" href="/trainingdays/assets/js/56.8ff32e8c.js"><link rel="prefetch" href="/trainingdays/assets/js/57.b055deed.js"><link rel="prefetch" href="/trainingdays/assets/js/58.ea5f9ba0.js"><link rel="prefetch" href="/trainingdays/assets/js/59.c31d4568.js"><link rel="prefetch" href="/trainingdays/assets/js/6.84280657.js"><link rel="prefetch" href="/trainingdays/assets/js/60.d5b59ce6.js"><link rel="prefetch" href="/trainingdays/assets/js/61.0f56f8b7.js"><link rel="prefetch" href="/trainingdays/assets/js/62.ffd711f5.js"><link rel="prefetch" href="/trainingdays/assets/js/63.6c4a6234.js"><link rel="prefetch" href="/trainingdays/assets/js/64.eaa0996c.js"><link rel="prefetch" href="/trainingdays/assets/js/65.0a417f03.js"><link rel="prefetch" href="/trainingdays/assets/js/67.30bc7e1a.js"><link rel="prefetch" href="/trainingdays/assets/js/68.99efc47f.js"><link rel="prefetch" href="/trainingdays/assets/js/69.96fdfd12.js"><link rel="prefetch" href="/trainingdays/assets/js/7.b1757800.js"><link rel="prefetch" href="/trainingdays/assets/js/70.4812f7a1.js"><link rel="prefetch" href="/trainingdays/assets/js/71.a9306771.js"><link rel="prefetch" href="/trainingdays/assets/js/72.cbb935db.js"><link rel="prefetch" href="/trainingdays/assets/js/73.4721e91f.js"><link rel="prefetch" href="/trainingdays/assets/js/74.d09bf052.js"><link rel="prefetch" href="/trainingdays/assets/js/75.42d71984.js"><link rel="prefetch" href="/trainingdays/assets/js/8.c22d1d77.js"><link rel="prefetch" href="/trainingdays/assets/js/9.3683845c.js">
    <link rel="stylesheet" href="/trainingdays/assets/css/0.styles.daa3f08c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/trainingdays/" class="home-link router-link-active"><!----> <span class="site-name">Azure Developer College</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azuredevcollege/trainingdays" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/trainingdays/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/trainingdays/day1/" class="sidebar-link">Day 1 Azure Fundamentals &amp; Infrastructure</a></li><li><a href="/trainingdays/day2/" class="sidebar-link">Day 2 Azure Development</a></li><li><a href="/trainingdays/day3/" class="sidebar-link">Day 3 Data and AI</a></li><li><a href="/trainingdays/day4/" class="sidebar-link">Day 4 Azure DevOps</a></li><li><a href="/trainingdays/day5/" aria-current="page" class="sidebar-link">Day 5 Identity and Architecture</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="receive-an-id-token-in-a-fragment-url"><a href="#receive-an-id-token-in-a-fragment-url" class="header-anchor">#</a> Receive an ID Token in a Fragment URL</h1> <h2 id="here-is-what-you-ll-learn"><a href="#here-is-what-you-ll-learn" class="header-anchor">#</a> Here is what you'll learn</h2> <ul><li>How to register an Azure AD application</li> <li>How to create an Open ID Connect request to authenticate an user</li> <li>How to receive an ID token in a <a href="https://en.wikipedia.org/wiki/Fragment_identifier" target="_blank" rel="noopener noreferrer">Fragment URL<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> for receiving information about the authenticated user</li></ul> <p>This is very similar to <a href="/trainingdays/day5/challenges/challenge-0.html">challenge 0</a>, except that this time we will receive the <code>id_token</code> through a fragment URL instead of it being in the body.</p> <h2 id="create-an-aad-application"><a href="#create-an-aad-application" class="header-anchor">#</a> Create an AAD application</h2> <p>Before you can authenticate an user you have to register an application in your AAD tenant.</p> <h3 id="azure-cli"><a href="#azure-cli" class="header-anchor">#</a> Azure CLI</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>az ad app create --display-name challengeidtokenfragment --reply-urls http://localhost:5001/api/tokenechofragment --identifier-uris https://challengeidtokenfragment
</code></pre></div><p>Retrieve and note the ID of your current AAD tenant via:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>az account show 
</code></pre></div><h2 id="run-the-token-echo-server"><a href="#run-the-token-echo-server" class="header-anchor">#</a> Run the Token Echo Server</h2> <p>Open another shell and run the Token Echo Server from <a href="../apps/token-echo-server"><code>day5/apps/token-echo-server</code></a> in this repository. This helper ASP.NET Core tool is used to echo the token issued by your Azure AD. The tool is listening on port 5001 on your local machine. Tokens are accepted on the route <code>http://localhost:5001/api/tokenechofragment</code>. This is why we initially registered an AAD application with a reply url pointing to <code>http://localhost:5001/api/tokenechofragment</code>.</p> <div class="language-shell extra-class"><pre class="language-shell"><code>dotnet run
</code></pre></div><h2 id="create-an-authentication-request"><a href="#create-an-authentication-request" class="header-anchor">#</a> Create an authentication request</h2> <p>Replace <code>TENANT_ID</code> with your TenantId and <code>APPLICATION_ID</code> with your ApplicationId. Open a browser and paste the modified request.</p> <div class="language- extra-class"><pre class="language-text"><code>https://login.microsoftonline.com/TENANT_ID/oauth2/v2.0/authorize?
client_id=APPLICATION_ID
&amp;response_type=id_token
&amp;redirect_uri=http%3A%2F%2Flocalhost%3A5001%2Fapi%2Ftokenechofragment
&amp;response_mode=fragment
&amp;scope=openid%20profile
&amp;nonce=1234
</code></pre></div><p>Copy the <code>id_token</code> value from your browser's address bar, go to <a href="https://jwt.ms" target="_blank" rel="noopener noreferrer">https://jwt.ms<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and paste the token. Take a minute and have a look at the decoded token.</p> <p>If you need further information about the issued claims take a look <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/id-tokens#header-claims" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="cleanup-resources"><a href="#cleanup-resources" class="header-anchor">#</a> Cleanup resources</h2> <h3 id="azure-cli-2"><a href="#azure-cli-2" class="header-anchor">#</a> Azure CLI</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>az ad app delete --id <span class="token operator">&lt;</span>applicationid<span class="token operator">&gt;</span>
</code></pre></div><h2 id="summary"><a href="#summary" class="header-anchor">#</a> Summary</h2> <p>This challenge showed how to create a new application in Azure AD and how an user can be authenticated using the Open ID Connect protocol. The full process is described <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-protocols-oidc" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azuredevcollege/trainingdays/edit/master/day5/challenges/challenge-1.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/trainingdays/assets/js/app.b6fa1fb8.js" defer></script><script src="/trainingdays/assets/js/2.2f5bd62b.js" defer></script><script src="/trainingdays/assets/js/66.ecd2c22b.js" defer></script>
  </body>
</html>
